$(function(e){"use strict";e(".inline-reservation-calender").length&&e(".inline-reservation-calender").pDatepicker({inline:!0,altField:"#inlineCalender",initialValue:!0,calendarType:"gregorian",initialValueType:!0,autoClose:!0,altFormat:"DD MMMM YY",calendar:{gregorian:{locale:"en"}},toolbox:{calendarSwitch:{enabled:!1}},navigator:{scroll:{enabled:!1},text:{btnNextText:"<",btnPrevText:">"}},minDate:(new persianDate).subtract("day",0).valueOf(),checkDate:function(e){return function(e){var n=new persianDate(e).day(),a=(new persianDate(e).startOf("day").unix(),new persianDate(e).endOf("day").unix(),!1);for(var t in availableDays)Number(availableDays[t])===n&&(a=!0);return a}(e)},timePicker:{enabled:!1},onSelect:function(n){var a=new persianDate(n),t=a.startOf("day").unix(),i=a.format("dddd"),s=a.format("YYYY-MM-DD");e("#selectedDay").val(s),function(n,a,t){var i=e("#PickTimeContainer"),s=e("#PickTimeBody"),r=e("#availableTimes"),o=i.find(".loading-img"),d=i.attr("data-user-id");i.removeClass("d-none"),e("html, body").animate({scrollTop:i.offset().top-window.innerHeight/2},600),s.addClass("d-none"),o.removeClass("d-none"),s.find(".selected_date span").text(e("#inlineCalender").val());var l={timestamp:n,day_label:a,date:t};e.post("/users/"+d+"/availableTimes",l,function(e){var n="";e&&void 0!==e.times&&(Object.keys(e.times).forEach(function(a){var t=e.times[a];n+='<div class="position-relative available-times '+(t.can_reserve?"":"disabled")+'">\n<input type="radio" name="time" id="availableTime'+t.id+'" value="'+t.id+'" '+(t.can_reserve?"":"disabled")+' data-type="'+t.meeting_type+'">\n<label for="availableTime'+t.id+'">'+t.time+"</label>\n",t.can_reserve||(n+='<span class="font-12 badge badge-danger text-white reserved-item">'+reservedLang+"</span>"),n+='<input type="hidden" class="js-time-description" value="'+t.description+'"/>',n+="</div>"}),r.html(n))}).always(function(){s.removeClass("d-none"),o.addClass("d-none")})}(t,i,s)}}),e("body").on("change",'input[name="time"]',function(n){if(this.checked){var a=e("#PickTimeBody"),t=e(this),i=t.attr("data-type"),s=t.parent().find("label").text(),r=a.find(".selected_date span").text();a.find(".selected-date-time span").text(r+" | "+s),e(".js-finalize-reserve").removeClass("d-none");var o=e('input[value="online"]').closest(".meeting-type-reserve"),d=e('input[value="in_person"]').closest(".meeting-type-reserve");o.removeClass("disabled"),o.find("input").prop("disabled",!1),d.removeClass("disabled"),d.find("input").prop("disabled",!1),"in_person"===i&&(o.addClass("disabled"),o.find("input").prop("disabled",!0)),"online"===i&&(d.addClass("disabled"),d.find("input").prop("disabled",!0));var l=t.parent().find(".js-time-description"),c=e(".js-time-description-card");l&&l.val()&&"null"!==l.val()&&"undefined"!==l.val()?(c.removeClass("d-none"),c.text(l.val())):c.addClass("d-none")}}),e("body").on("change",'input[name="meeting_type"]',function(n){if(e("#withGroupMeetingSwitch").prop("checked",!1),e(".js-group-meeting-options").addClass("d-none"),e('input[name="student_count"]').val(1),e(".wrunner").remove(),this.checked){var a=e(this).val(),t=e(".js-group-meeting-switch"),i=e(".js-online-group-amount"),s=e(".js-in-person-group-amount");t.removeClass("d-none").addClass("d-flex"),"in_person"===a&&(i.addClass("d-none"),s.removeClass("d-none")),"online"===a&&(i.removeClass("d-none"),s.addClass("d-none")),e(".js-reserve-btn").removeClass("d-none").addClass("d-flex"),e(".js-reserve-description").removeClass("d-none")}}),e("body").on("change","#withGroupMeetingSwitch",function(n){var a=e(".js-group-meeting-options");e('input[name="student_count"]').val(1),e(".wrunner").remove(),this.checked?(a.removeClass("d-none"),function(){var n=e("#studentCountRange");if(n&&jQuery().wRunner){var a=e('input[name="meeting_type"]:checked').val();if(a){var t=n.attr("data-minLimit"),i="in_person"===a?e("#in_person_group_max_student").val():e("#online_group_max_student").val(),s=n.find('input[name="student_count"]'),r=n.wRunner({type:"single",limits:{minLimit:t,maxLimit:i},singleValue:t,step:1});r.onValueUpdate(function(e){s.val(e.value)})}}}()):a.addClass("d-none")}),e("body").on("click",".js-submit-form",function(n){n.preventDefault();var a=e(this);a.addClass("loadingbar primary").prop("disabled",!0);var t=a.closest("form"),i=(t.attr("action"),t.serializeObject());e.post("/meetings/reserve",i,function(n){e.toast({heading:n.title,text:n.msg,bgColor:"success"===n.status?"#43d477":"#f63c3c",textColor:"white",hideAfter:1e4,position:"bottom-right",icon:n.status}),"success"===n.status&&void 0!==n.redirect?window.location.href=n.redirect:a.removeClass("loadingbar gray").prop("disabled",!1)}).fail(function(e){a.removeClass("loadingbar gray").prop("disabled",!1)})}),e("body").on("click","#followToggle",function(n){n.preventDefault();var a=e(this);a.addClass("loadingbar primary").prop("disabled",!0);var t="/users/"+a.attr("data-user-id")+"/follow";e.get(t,function(e){a.removeClass("loadingbar primary").prop("disabled",!1),e&&200===e.code&&(e.follow?(a.removeClass("btn-primary").addClass("btn-danger"),a.text(unFollowLang)):(a.removeClass("btn-danger").addClass("btn-primary"),a.text(followLang)))})}),e("body").on("click",".js-refresh-captcha",function(e){e.preventDefault(),refreshCaptcha()}),e("body").on("click",".js-send-message",function(n){n.preventDefault(),Swal.fire({html:e("#sendMessageModal").html(),showCancelButton:!1,showConfirmButton:!1,customClass:{content:"p-0 text-left"},onOpen:function(){refreshCaptcha()},width:"42rem"})}),e("body").on("click",".js-send-message-submit",function(n){n.preventDefault();var a=e(this);a.addClass("loadingbar primary").prop("disabled",!0);var t=a.closest("form"),i=t.attr("action"),s=t.serializeObject();e.post(i,s,function(e){e&&200===e.code?(Swal.fire({icon:"success",html:'<h3 class="font-20 text-center text-dark-blue">'+messageSuccessSentLang+"</h3>",showConfirmButton:!1}),setTimeout(function(){window.location.reload()},2e3)):Swal.fire({icon:"error",html:'<h3 class="font-20 text-center text-dark-blue">'+e.message+"</h3>",showConfirmButton:!1})}).fail(function(e){a.removeClass("loadingbar primary").prop("disabled",!1);var n=e.responseJSON;refreshCaptcha(),n&&n.errors&&Object.keys(n.errors).forEach(function(e){var a=n.errors[e],i=t.find('[name="'+e+'"]');i.addClass("is-invalid"),i.parent().find(".invalid-feedback").text(a[0])})})})});
